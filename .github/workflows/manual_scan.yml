name: ðŸ¤– Run NBA Scanner

# Trigger manually from the Actions tab
on:
  workflow_dispatch:

# ðŸŸ¢ CRITICAL: This gives the bot permission to write to your repo
permissions:
  contents: write

jobs:
  run-scanner:
    runs-on: ubuntu-latest
    
    steps:
    # 1. Check out the repository
    - name: Checkout Code
      uses: actions/checkout@v3

    # 2. Install Python 3.9
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    # 3. Install Libraries (Added joblib just in case)
    - name: Install Dependencies
      run: |
        pip install pandas numpy xgboost nba_api requests python-dotenv fuzzywuzzy scikit-learn joblib

    # 4. Re-Build Data (Recreates the missing CSV from scratch)
    - name: Build & Engineer Data
      run: |
        python3 src/builder.py
        python3 src/features.py

    # 5. Run the Bot (Headless Mode)
    - name: Run AI Scanner
      env:
        ODDS_API_KEY: ${{ secrets.ODDS_API_KEY }}
      run: |
        python3 run_bot.py

    # 6. Save Results back to GitHub
    - name: Commit & Push Results
      run: |
        git config --global user.name "NBA-Bot-Action"
        git config --global user.email "bot@github.com"
        git add data/projections/*.csv
        git commit -m "ðŸ¤– daily update: automated scan results" || exit 0
        git push